<%- include('../partials/head', { title: 'Ella Rises' }) %>
<%- include('../partials/navbar', { currentPath: '/admin/participants' }) %>
<div class="min-h-screen bg-background pt-28 pb-20">
  <div class="container mx-auto px-6">
    <div class="flex items-center gap-4 mb-8">
      <a href="/admin/participants" class="text-foreground/60 hover:text-foreground">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
      </a>
      <h1 class="text-4xl md:text-6xl font-serif text-foreground">Participant Details</h1>
    </div>
    <div id="participant-detail">
      <p class="text-foreground/60">Loading...</p>
    </div>
  </div>
</div>
<%- include('../partials/notification-modal') %>
<%- include('../partials/footer') %>
<script>
  const participantId = window.location.pathname.split('/').pop();
  
  // Load all participant data
  Promise.all([
    fetch(`/api/participants/${participantId}`).then(r => r.json()),
    fetch(`/api/participants/${participantId}/registrations`).then(r => r.json()).catch(() => []),
    fetch(`/api/participants/${participantId}/milestones`).then(r => r.json()).catch(() => []),
    fetch(`/api/participants/${participantId}/donations`).then(r => r.json()).catch(() => ({ TotalDonations: 0 }))
  ]).then(([participant, registrations, milestones, donations]) => {
    const now = new Date();
    
    // Separate upcoming and past events
    const upcomingEvents = registrations.filter(r => new Date(r.EventDateTimeStart) > now);
    const pastEvents = registrations.filter(r => new Date(r.EventDateTimeStart) <= now);
    
    // Separate achieved and planned milestones (using same logic as user dashboard)
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const futurePlaceholder = new Date('2099-12-31');
    futurePlaceholder.setHours(0, 0, 0, 0);
    
    const achievedMilestones = milestones.filter(m => {
      const milestoneDate = new Date(m.MilestoneDate);
      milestoneDate.setHours(0, 0, 0, 0);
      // Exclude placeholder date (future milestones)
      return milestoneDate <= today && milestoneDate.getTime() !== futurePlaceholder.getTime();
    });
    
    const plannedMilestones = milestones.filter(m => {
      const milestoneDate = new Date(m.MilestoneDate);
      milestoneDate.setHours(0, 0, 0, 0);
      // Include placeholder date (future milestones without dates)
      return milestoneDate.getTime() === futurePlaceholder.getTime() || milestoneDate > today;
    });
    
    const totalDonations = donations.TotalDonations || donations.reduce?.((sum, d) => sum + parseFloat(d.DonationAmount || 0), 0) || 0;
    
    document.getElementById('participant-detail').innerHTML = `
      <!-- Profile Card & Donations Row -->
      <div class="grid md:grid-cols-2 gap-6 mb-8">
        <!-- Profile Card -->
        <div class="bg-card border border-border rounded-xl p-6 shadow-sm">
          <div class="flex items-center gap-6">
            <div class="flex-shrink-0">
              <div class="relative group">
                ${participant.ParticipantPhotoPath 
                  ? `<img src="${participant.ParticipantPhotoPath}" alt="Profile Photo" class="w-24 h-24 object-cover rounded-full border-2 border-border" id="profile-photo-img">`
                  : `<div class="w-24 h-24 rounded-full bg-muted border-2 border-border flex items-center justify-center" id="profile-photo-placeholder">
                      <span class="text-2xl text-foreground/40">${(participant.ParticipantFirstName || '').charAt(0)}${(participant.ParticipantLastName || '').charAt(0)}</span>
                    </div>`
                }
                <label class="absolute inset-0 flex items-center justify-center bg-black/50 rounded-full opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity">
                  <span class="text-white text-xs font-medium">Change</span>
                  <input type="file" id="photo-upload-input" accept="image/*" class="hidden" onchange="uploadPhoto(this, ${participant.ParticipantID})">
                </label>
              </div>
              <label class="block text-center mt-2 text-xs text-primary hover:underline cursor-pointer">
                <span>Change Photo</span>
                <input type="file" accept="image/*" class="hidden" onchange="uploadPhoto(this, ${participant.ParticipantID})">
              </label>
            </div>
            <div class="flex-1">
              <h2 class="text-2xl font-serif text-foreground mb-1">${participant.ParticipantFirstName} ${participant.ParticipantLastName}</h2>
              <p class="text-foreground/60 mb-1">${participant.ParticipantEmail}</p>
              <span class="inline-block px-2 py-1 rounded-full text-xs font-medium ${participant.ParticipantRole === 'admin' ? 'bg-amber-100 text-amber-800' : 'bg-blue-100 text-blue-800'}">
                ${participant.ParticipantRole || 'participant'}
              </span>
            </div>
          </div>
          <div class="mt-4 pt-4 border-t border-border grid grid-cols-2 gap-4 text-sm">
            <div><strong>Phone:</strong> ${participant.ParticipantPhone || 'N/A'}</div>
            <div><strong>DOB:</strong> ${participant.ParticipantDOB ? new Date(participant.ParticipantDOB).toLocaleDateString() : 'N/A'}</div>
            <div><strong>City:</strong> ${participant.ParticipantCity || 'N/A'}</div>
            <div><strong>State:</strong> ${participant.ParticipantState || 'N/A'}</div>
            <div><strong>Zip:</strong> ${participant.ParticipantZip || 'N/A'}</div>
            <div><strong>Interest:</strong> ${participant.ParticipantFieldOfInterest || 'N/A'}</div>
            <div class="col-span-2"><strong>School/Employer:</strong> ${participant.ParticipantSchoolOrEmployer || 'N/A'}</div>
          </div>
        </div>
        
        <!-- Donations Summary -->
        <div class="bg-card border border-border rounded-xl p-6 shadow-sm">
          <h2 class="text-xl font-serif text-foreground mb-4">Donations</h2>
          <p class="text-foreground/60 mb-2">Total contributed</p>
          <p class="text-3xl font-semibold text-primary mb-4">$${parseFloat(totalDonations).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
          
          <h3 class="text-lg font-medium mb-2">Stats</h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="bg-muted rounded-lg p-3 text-center">
              <p class="text-2xl font-bold text-primary">${registrations.length}</p>
              <p class="text-foreground/60">Total Registrations</p>
            </div>
            <div class="bg-muted rounded-lg p-3 text-center">
              <p class="text-2xl font-bold text-primary">${milestones.length}</p>
              <p class="text-foreground/60">Milestones</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Combined Milestones Section -->
      <div class="mb-8">
        <h2 class="text-2xl md:text-3xl font-serif text-foreground mb-6">Milestones</h2>
        <div class="bg-card border border-border rounded-xl p-6 shadow-sm">
          <div class="grid md:grid-cols-2 gap-6">
            <!-- Left: Completed Milestones -->
            <div>
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-serif text-foreground">Completed Milestones</h3>
                <button 
                  onclick="openAddMilestoneModal(true, ${participant.ParticipantID})"
                  class="bg-primary hover:bg-primary/90 text-primary-foreground px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                >
                  + Add
                </button>
              </div>
              <div class="space-y-3 max-h-96 overflow-y-auto">
                ${achievedMilestones.length > 0 ? achievedMilestones.map(m => {
                  const milestoneDate = new Date(m.MilestoneDate);
                  const futurePlaceholderDate = new Date('2099-12-31');
                  const dateStr = milestoneDate.toISOString().split('T')[0];
                  const isPlaceholder = milestoneDate.getTime() === futurePlaceholderDate.getTime();
                  
                  return `
                    <div 
                      class="bg-background border border-border rounded-lg p-4 flex items-start justify-between gap-3"
                      data-milestone-id="${m.Id || m.MilestoneID}"
                      data-milestone-type-id="${m.MilestoneID}"
                      data-milestone-date="${dateStr}"
                      data-participant-id="${participant.ParticipantID}"
                      data-is-completed="true"
                    >
                      <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                          <h4 class="text-base font-serif text-foreground">${m.MilestoneTitle || 'Milestone'}</h4>
                          <span class="text-sm text-primary">✓</span>
                        </div>
                        <p class="text-sm text-foreground/60">
                          ${!isPlaceholder ? milestoneDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : ''}
                        </p>
                      </div>
                      <div class="flex gap-2">
                        <button 
                          onclick="openEditMilestoneModalFromElement(this.closest('[data-milestone-id]'), ${participant.ParticipantID})"
                          class="bg-primary hover:bg-primary/90 text-primary-foreground px-3 py-1 rounded text-sm font-medium transition-colors"
                        >
                          Edit
                        </button>
                        <button 
                          onclick="deleteMilestone(${m.Id || m.MilestoneID}, ${participant.ParticipantID})"
                          class="bg-destructive hover:bg-destructive/90 text-destructive-foreground px-3 py-1 rounded text-sm font-medium transition-colors"
                        >
                          Delete
                        </button>
                      </div>
                    </div>
                  `;
                }).join('') : `
                  <p class="text-foreground/60 text-sm text-center py-4">No milestones achieved yet. Keep participating to earn milestones!</p>
                `}
              </div>
            </div>

            <!-- Right: Future Milestone Goals -->
            <div>
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-serif text-foreground">Future Milestone Goals</h3>
                <button 
                  onclick="openAddMilestoneModal(false, ${participant.ParticipantID})"
                  class="bg-primary hover:bg-primary/90 text-primary-foreground px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                >
                  + Add
                </button>
              </div>
              <div class="space-y-3 max-h-96 overflow-y-auto">
                ${plannedMilestones.length > 0 ? plannedMilestones.map(m => {
                  const milestoneDate = new Date(m.MilestoneDate);
                  const futurePlaceholderDate = new Date('2099-12-31');
                  const dateStr = milestoneDate.toISOString().split('T')[0];
                  const isPlaceholder = milestoneDate.getTime() === futurePlaceholderDate.getTime();
                  
                  return `
                    <div 
                      class="bg-background border border-border rounded-lg p-4 flex items-start justify-between gap-3"
                      data-milestone-id="${m.Id || m.MilestoneID}"
                      data-milestone-type-id="${m.MilestoneID}"
                      data-milestone-date="${dateStr}"
                      data-participant-id="${participant.ParticipantID}"
                      data-is-completed="false"
                    >
                      <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                          <h4 class="text-base font-serif text-foreground">${m.MilestoneTitle || 'Milestone'}</h4>
                          <span class="text-sm text-foreground/40">○</span>
                        </div>
                        <p class="text-sm text-foreground/60">
                          ${!isPlaceholder ? `<strong>Goal Date:</strong> ${milestoneDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}` : ''}
                        </p>
                      </div>
                      <div class="flex gap-2">
                        <button 
                          onclick="openEditMilestoneModalFromElement(this.closest('[data-milestone-id]'), ${participant.ParticipantID})"
                          class="bg-primary hover:bg-primary/90 text-primary-foreground px-3 py-1 rounded text-sm font-medium transition-colors"
                        >
                          Edit
                        </button>
                        <button 
                          onclick="deleteMilestone(${m.Id || m.MilestoneID}, ${participant.ParticipantID})"
                          class="bg-destructive hover:bg-destructive/90 text-destructive-foreground px-3 py-1 rounded text-sm font-medium transition-colors"
                        >
                          Delete
                        </button>
                      </div>
                    </div>
                  `;
                }).join('') : `
                  <p class="text-foreground/60 text-sm text-center py-4">No planned milestones at this time.</p>
                `}
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Upcoming Events -->
      <div class="mb-8">
        <h2 class="text-2xl font-serif text-foreground mb-4">Upcoming Events</h2>
        ${upcomingEvents.length > 0 ? `
          <div class="space-y-4">
            ${upcomingEvents.map(e => `
              <div class="bg-card border border-border rounded-xl p-4 shadow-sm">
                <h3 class="text-lg font-serif text-foreground mb-2">${e.EventName}</h3>
                <div class="text-sm text-foreground/60">
                  <p><strong>Date:</strong> ${new Date(e.EventDateTimeStart).toLocaleString()}</p>
                  ${e.EventLocation ? `<p><strong>Location:</strong> ${e.EventLocation}</p>` : ''}
                </div>
              </div>
            `).join('')}
          </div>
        ` : `
          <div class="bg-card border border-border rounded-xl p-6 text-center">
            <p class="text-foreground/60">No upcoming events.</p>
          </div>
        `}
      </div>
      
      <!-- Past Events -->
      <div class="mb-8">
        <h2 class="text-2xl font-serif text-foreground mb-4">Past Events</h2>
        ${pastEvents.length > 0 ? `
          <div class="space-y-4">
            ${pastEvents.map(e => `
              <div class="bg-card border border-border rounded-xl p-4 shadow-sm">
                <h3 class="text-lg font-serif text-foreground mb-2">${e.EventName}</h3>
                <div class="text-sm text-foreground/60">
                  <p><strong>Date:</strong> ${new Date(e.EventDateTimeStart).toLocaleString()}</p>
                  ${e.EventLocation ? `<p><strong>Location:</strong> ${e.EventLocation}</p>` : ''}
                  <p><strong>Attended:</strong> ${e.RegistrationAttendedFlag ? 'Yes' : 'No'}</p>
                </div>
              </div>
            `).join('')}
          </div>
        ` : `
          <div class="bg-card border border-border rounded-xl p-6 text-center">
            <p class="text-foreground/60">No past events.</p>
          </div>
        `}
      </div>
    `;
  }).catch(err => {
    console.error('Error loading participant:', err);
    document.getElementById('participant-detail').innerHTML = '<p class="text-red-600">Error loading participant details.</p>';
  });

  // Photo upload function
  async function uploadPhoto(input, participantId) {
    const file = input.files[0];
    if (!file) return;
    
    const formData = new FormData();
    formData.append('photo', file);
    
    try {
      const response = await fetch(`/api/participants/${participantId}/photo`, {
        method: 'POST',
        body: formData
      });
      
      if (response.ok) {
        // Reload the page to show the new photo
        location.reload();
      } else {
        const error = await response.json();
        showNotification('Error uploading photo: ' + (error.message || 'Upload failed'), 'error', 'Upload Error');
      }
    } catch (err) {
      console.error('Upload error:', err);
      showNotification('Error uploading photo', 'error', 'Upload Error');
    }
  }

  // Milestone management functions
  let milestoneTypes = [];
  let currentParticipantId = null;

  // Load milestone types
  async function loadMilestoneTypes() {
    try {
      const res = await fetch('/api/milestones/types', {
        credentials: 'same-origin'
      });
      if (res.ok) {
        milestoneTypes = await res.json();
        const select = document.getElementById('milestoneType');
        if (select) {
          select.innerHTML = '<option value="">Select a milestone...</option>';
          milestoneTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type.MilestoneID;
            option.textContent = type.MilestoneTitle;
            select.appendChild(option);
          });
        }
      }
    } catch (error) {
      console.error('Error loading milestone types:', error);
    }
  }

  // Open add milestone modal
  async function openAddMilestoneModal(isCompleted, participantId) {
    currentParticipantId = participantId;
    await loadMilestoneTypes();
    document.getElementById('milestoneModalTitle').textContent = isCompleted 
      ? 'Add Completed Milestone' 
      : 'Add Future Milestone Goal';
    document.getElementById('milestoneId').value = '';
    document.getElementById('isCompleted').value = isCompleted ? 'true' : 'false';
    document.getElementById('milestoneType').value = '';
    document.getElementById('milestoneDate').value = '';
    
    const dateField = document.getElementById('dateField');
    const dateLabel = document.getElementById('dateFieldLabel');
    const dateHelp = document.getElementById('dateFieldHelp');
    const dateInput = document.getElementById('milestoneDate');
    
    if (isCompleted) {
      dateLabel.textContent = 'Date Achieved';
      dateInput.required = true;
      dateHelp.textContent = '';
    } else {
      dateLabel.textContent = 'Goal Date to Achieve Milestone By';
      dateInput.required = false;
      dateHelp.textContent = 'Optional - leave blank if no specific goal date';
    }
    
    document.getElementById('milestoneModal').classList.remove('hidden');
  }

  // Open edit milestone modal from element
  async function openEditMilestoneModalFromElement(element, participantId) {
    currentParticipantId = participantId;
    await loadMilestoneTypes();
    
    const milestoneId = element.dataset.milestoneId;
    const milestoneTypeId = element.dataset.milestoneTypeId;
    const milestoneDate = element.dataset.milestoneDate;
    const isCompleted = element.dataset.isCompleted === 'true';
    
    document.getElementById('milestoneModalTitle').textContent = isCompleted 
      ? 'Edit Completed Milestone' 
      : 'Edit Future Milestone Goal';
    document.getElementById('milestoneId').value = milestoneId;
    document.getElementById('isCompleted').value = isCompleted ? 'true' : 'false';
    document.getElementById('milestoneType').value = milestoneTypeId;
    
    const form = document.getElementById('milestoneForm');
    form.dataset.originalMilestoneId = milestoneTypeId;
    form.dataset.originalMilestoneDate = milestoneDate;
    form.dataset.originalParticipantId = participantId;
    
    const dateField = document.getElementById('dateField');
    const dateLabel = document.getElementById('dateFieldLabel');
    const dateHelp = document.getElementById('dateFieldHelp');
    const dateInput = document.getElementById('milestoneDate');
    
    if (isCompleted) {
      dateLabel.textContent = 'Date Achieved';
      dateInput.required = true;
      dateHelp.textContent = '';
    } else {
      dateLabel.textContent = 'Goal Date to Achieve Milestone By';
      dateInput.required = false;
      dateHelp.textContent = 'Optional - leave blank if no specific goal date';
    }
    
    const date = new Date(milestoneDate);
    const futurePlaceholder = new Date('2099-12-31');
    if (date.getTime() !== futurePlaceholder.getTime()) {
      dateInput.value = date.toISOString().split('T')[0];
    } else {
      dateInput.value = '';
    }
    
    document.getElementById('milestoneModal').classList.remove('hidden');
  }

  // Close milestone modal
  function closeMilestoneModal() {
    document.getElementById('milestoneModal').classList.add('hidden');
    document.getElementById('milestoneForm').reset();
    currentParticipantId = null;
  }

  // Handle milestone form submission
  async function handleMilestoneSubmit(event) {
    event.preventDefault();
    
    const milestoneId = document.getElementById('milestoneId').value;
    const isCompleted = document.getElementById('isCompleted').value === 'true';
    const MilestoneID = document.getElementById('milestoneType').value;
    const MilestoneDate = document.getElementById('milestoneDate').value;
    const ParticipantID = currentParticipantId;
    const form = document.getElementById('milestoneForm');

    try {
      let res;
      if (milestoneId) {
        const dateValue = isCompleted 
          ? MilestoneDate 
          : (MilestoneDate || null);
        
        const body = {
          MilestoneID,
          MilestoneDate: dateValue,
          isFuture: !isCompleted
        };
        
        if (form.dataset.originalMilestoneId) {
          body.originalMilestoneID = form.dataset.originalMilestoneId;
          body.originalMilestoneDate = form.dataset.originalMilestoneDate;
          body.ParticipantID = form.dataset.originalParticipantId;
        }
        
        res = await fetch(`/api/milestones/${milestoneId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          credentials: 'same-origin',
          body: JSON.stringify(body)
        });
      } else {
        const dateValue = isCompleted 
          ? MilestoneDate 
          : (MilestoneDate || null);
        
        res = await fetch('/api/milestones', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          credentials: 'same-origin',
          body: JSON.stringify({
            MilestoneID,
            ParticipantID,
            MilestoneDate: dateValue,
            isFuture: !isCompleted
          })
        });
      }

      if (!res.ok) {
        let errorMessage = 'Failed to save milestone';
        const contentType = res.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
          try {
            const error = await res.json();
            errorMessage = error.message || errorMessage;
          } catch (e) {
            errorMessage = `Server error: ${res.status} ${res.statusText}`;
          }
        } else {
          errorMessage = `Server error: ${res.status} ${res.statusText}`;
        }
        throw new Error(errorMessage);
      }

      closeMilestoneModal();
      window.location.reload();
    } catch (error) {
      showNotification('Error: ' + error.message, 'error', 'Error');
      console.error('Milestone save error:', error);
    }
  }

  // Delete milestone
  async function deleteMilestone(milestoneId, participantId) {
    const element = document.querySelector(`[data-milestone-id="${milestoneId}"]`);
    const milestoneTypeId = element?.dataset.milestoneTypeId;
    const milestoneDate = element?.dataset.milestoneDate;
    
    showConfirmation('Are you sure you want to delete this milestone?', async () => {
      await performDeleteMilestone(milestoneId, participantId, milestoneTypeId, milestoneDate);
    }, 'Delete Milestone');
  }
  
  async function performDeleteMilestone(milestoneId, participantId, milestoneTypeId, milestoneDate) {

    try {
      const element = document.querySelector(`[data-milestone-id="${milestoneId}"]`);
      let url = `/api/milestones/${milestoneId}`;
      
      if (element) {
        const params = new URLSearchParams({
          ParticipantID: element.dataset.participantId,
          MilestoneID: element.dataset.milestoneTypeId,
          MilestoneDate: element.dataset.milestoneDate
        });
        url += '?' + params.toString();
      }
      
      const res = await fetch(url, {
        method: 'DELETE',
        credentials: 'same-origin',
        headers: {
          'Accept': 'application/json'
        }
      });

      if (!res.ok) {
        let errorMessage = 'Failed to delete milestone';
        const contentType = res.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
          try {
            const error = await res.json();
            errorMessage = error.message || errorMessage;
          } catch (e) {
            errorMessage = `Server error: ${res.status} ${res.statusText}`;
          }
        } else {
          errorMessage = `Server error: ${res.status} ${res.statusText}`;
        }
        throw new Error(errorMessage);
      }

      window.location.reload();
    } catch (error) {
      showNotification('Error: ' + error.message, 'error', 'Error');
      console.error('Delete milestone error:', error);
    }
  }
</script>

<!-- Add/Edit Milestone Modal -->
<div id="milestoneModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-card border border-border rounded-xl p-6 max-w-md w-full mx-4">
    <h3 id="milestoneModalTitle" class="text-2xl font-serif text-foreground mb-4">Add Milestone</h3>
    <form id="milestoneForm" onsubmit="handleMilestoneSubmit(event)">
      <input type="hidden" id="milestoneId" />
      <input type="hidden" id="isCompleted" />
      
      <div class="mb-4">
        <label for="milestoneType" class="block text-sm font-medium text-foreground mb-2">
          Milestone Type
        </label>
        <select 
          id="milestoneType" 
          required
          class="w-full px-4 py-2 border border-border rounded-lg bg-background text-foreground"
        >
          <option value="">Select a milestone...</option>
        </select>
      </div>

      <div id="dateField" class="mb-4">
        <label id="dateFieldLabel" for="milestoneDate" class="block text-sm font-medium text-foreground mb-2">
          Date Achieved
        </label>
        <input 
          type="date" 
          id="milestoneDate" 
          class="w-full px-4 py-2 border border-border rounded-lg bg-background text-foreground"
        />
        <p id="dateFieldHelp" class="text-xs text-foreground/60 mt-1"></p>
      </div>

      <div class="flex gap-3">
        <button 
          type="submit"
          class="flex-1 bg-primary hover:bg-primary/90 text-primary-foreground px-6 py-2 rounded-lg font-medium transition-colors"
        >
          Save
        </button>
        <button 
          type="button"
          onclick="closeMilestoneModal()"
          class="flex-1 bg-muted hover:bg-muted/80 text-foreground px-6 py-2 rounded-lg font-medium transition-colors"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // Close modal when clicking outside
  document.getElementById('milestoneModal')?.addEventListener('click', (e) => {
    if (e.target.id === 'milestoneModal') {
      closeMilestoneModal();
    }
  });
</script>

